암호화폐 자동매매 전략

# 변동성 돌파 + 오전오후

1. 변동성 돌파 전략
2. 오전오후 전략

**혼합 방법**: 전체 투자 금액을 두 전략에 각각 50%씩 할당하여 독립적으로 운용한다.

두 전략의 매도 시그널, 매도 비중은 동일하다. "오후가 되면, 전량 매도"이다.

- 변동성 돌파 전략
    - 매수 시그널
        1. 오전 시간대 (00:00 - 12:00)
        2. 현재가 > 당일 시가(00:00) + 전일 오전 레인지 * 최근 20일 오전 노이즈 비율 평균
            - 노이즈 평균(k)이 변동성 돌파 계수 역할

        - 최근 20일 오전 노이즈 비율 평균
            1. 최근 20일 오전 데이터 추출
            2. 노이즈 계산
            3. 평균 내기
        - 당일 시가: 전일 오후 종가와 같다.
    - 매수 비중
        - 계산식: (타겟 변동성 / 전일 오전 변동성) * 3,5,10,20일 오전 이동평균선 스코어
        - 결과값: 0 ~ 1 사이의 비율
        - 실제 매수 금액: 전략 할당 금액(계좌 자산의 50%) * 계산된 비중
        - 예시: 타겟 1%, 전일 변동성 2%, 이평선 스코어 0.5 → (0.01/0.02) * 0.5 = 0.25
          → 전략 할당 금액 100만원 * 0.25 = 25만원 매수
    - 매수 시점
        - 오전 동안 지속적으로 조건 확인 (체크 간격: 1분)
        - 체크 시간: 00:01 ~ 11:59
        - 최초 조건 충족 시 1회 매수 후 오후까지 추가 매수 없음
        - 매수 비중이 0 이하이면 조건 확인 생략

- 오전오후 전략
    - 매수 시그널
        1. 오전 시간대 (00:00 - 12:00)
        2. 전일 오후 수익률 > 0
        3. 전일 오전 거래량 < 전일 오후 거래량
    - 매수 비중
        - 계산식: 타겟 변동성 / 전일 오전 변동성
        - 결과값: 0 ~ 1 사이의 비율
        - 실제 매수 금액: 전략 할당 금액(계좌 자산의 50%) * 계산된 비중
        - 예시: 타겟 1%, 전일 오전 변동성 2% → 0.01/0.02 = 0.5
          → 전략 할당 금액 100만원 * 0.5 = 50만원 매수
    - 실행
        - 오전 1번
        - 오후 1번

### 시간 정의

- 오전: 00:00 - 12:00 (UTC+9, 한국 표준시 기준)
- 오후: 12:00 - 24:00 (UTC+9, 한국 표준시 기준)
- 모든 시간은 암호화폐 거래소의 일봉 구분 기준과 동일
- 00:00 = 자정 (하루의 시작점)

### 용어

- 타겟 변동성: 0.5 ~ 2% (목표로 하는 일일 변동성 비율, 사용자 설정값)

- 변동성: 레인지 / 시가 (오전 변동성의 경우 오전 레인지 / 오전 시가)

- 레인지: 고가 - 저가

- 노이즈: 캔들에서 꼬리가 차지하는 비율. `1 - abs(시가 - 종가) / (고가 - 저가)` 꼬리가 클 수록 노이즈가 커진다.

- 전일 오후 수익률: `(전일 오후 종가 - 전일 오후 시가) / 전일 오후 시가`
    - 전일 오후 시가: 전일 12:00 시점의 가격
    - 전일 오후 종가: 전일 24:00 시점의 가격 (익일 00:00 직전)

- 전일 오전 거래량: 전일 00:00~12:00 구간의 누적 거래량 (단위: 코인 수량)

- 전일 오후 거래량: 전일 12:00~24:00 구간의 누적 거래량 (단위: 코인 수량)

- 3,5,10,20일 오전 이평선 스코어
    - 계산 방법:
        1. 각 이평선(3일, 5일, 10일, 20일)이 전일 오전 종가보다 큰지 확인
        2. 조건을 만족하는 이평선 개수를 4로 나눔
    - 결과값: 0 ~ 1 사이의 비율
    - 계산 기준 시점: 당일 00:00
    - 예시:
        - 3일, 5일 이평선만 전일 오전 종가보다 큼 → 2/4 = 0.5
        - 모든 이평선이 전일 오전 종가보다 큼 → 4/4 = 1.0
        - 모든 이평선이 전일 오전 종가보다 작음 → 0/4 = 0.0
    - 이평선 계산:
        - 3일 오전 이평선 = (최근 3일간 오전 종가의 합) / 3
        - 5일 오전 이평선 = (최근 5일간 오전 종가의 합) / 5
        - 당일이 1월 5일이면, 1월 4일~1월 (5-N)일의 오전 종가 평균

### 매수 비중 제한

- 단일 전략 할당 금액: 계좌 전체 자산의 50%
- 단일 전략 최대 매수 비중: 할당 금액의 100% (즉, 계좌 자산의 50%)
- 전체 최대 매수 비중: 계좌 자산의 100% (두 전략 모두 최대 매수 시)
- 계산된 매수 비중이 1.0을 초과하면 1.0으로 제한
- 계산된 매수 비중이 0 이하이면 매수하지 않음
- 매수 금액 계산: 전략 할당 금액 * min(계산된 비중, 1.0)

### 위험 관리

#### 매도 로직 상세

- 매도 시점: 12:00:00 (KST)
- 매도 방식: 시장가 전량 매도
- 재시도: 매도 실패 시 1분 간격으로 최대 3회 재시도
- 두 전략의 포지션을 병렬로 매도 처리

#### 비상 손절

- **추후 결정** (급격한 하락 시 대응 방안 고려 필요)

#### 기타

- 최소 매수 금액: 거래소 최소 주문 금액 (예: 5,000원) 이상

#### 예외 상황 처리

- **변동성이 0인 경우**: 전일 오전 변동성이 0.1% 미만이면 매수하지 않음
- **레인지가 0인 경우**: 고가 = 저가인 경우 노이즈를 0으로 처리
- **데이터 부족**: 20일 미만의 데이터인 경우 전략 실행을 대기
- **계산 결과 비정상**: 매수 비중이 음수이거나 무한대인 경우 매수하지 않음

#### 시스템 오류 처리

- **API 호출 실패**: 3회 재시도 (1초 간격), 실패 시 해당 작업 건너뛰기
- **데이터 수집 실패**: 로그 기록 후 전략 실행 중단
- **주문 실패**: 잔고/최소 주문 금액 체크 후 재시도, 3회 실패 시 경고
- **거래소 점검**: 점검 시간 체크 후 전략 일시 중단

### 데이터 요구사항

- 오전/오후 구분된 OHLCV 데이터 (최소 20일치)
- 오전: 00:00-12:00 구간
- 오후: 12:00-24:00 구간
- 필요한 지표: 시가, 고가, 저가, 종가, 거래량
- **워밍업 기간**: 최소 20일의 데이터 축적 후 전략 실행 시작
- 초기 실행 시 20일간은 데이터 수집만 수행

### 실행 흐름

1. **매일 00:00** - 데이터 수집 및 지표 계산
    - 최근 20일 오전/오후 데이터 로드
    - 각 전략별 매수 비중 사전 계산 (최적화)
2. **오전오후 전략** - 00:00 시점에 1회 실행
    - 매수 비중 > 0 이면 조건 확인
    - 조건 충족 시 즉시 매수
3. **변동성 돌파 전략** - 오전 동안 지속 확인
    - 매수 비중 > 0 이면 조건 확인 시작
    - 최초 조건 충족 시 매수 후 확인 중단
4. **12:00 (오후 시작)** - 보유 포지션 전량 매도

**참고**: 두 전략은 독립적으로 실행되며, 장이 좋은 경우 동시에 매수할 수 있습니다.
이 경우 전체 계좌의 최대 100%까지 투자될 수 있습니다.